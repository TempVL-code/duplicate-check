<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤</title>
<style>
body { font-family: Arial, sans-serif; max-width: 1100px; margin: 30px auto; }
textarea { width: 100%; height: 220px; }
button { padding: 8px 16px; margin: 5px 5px 5px 0; }
pre { background: #f4f4f4; padding: 10px; white-space: pre-wrap; }
input { width: 60px; }
.stat { font-weight: bold; margin: 5px 0; }
details { margin-top: 5px; }
</style>
</head>
<body>

<h2>üîÅ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤ –Ω–æ–º–µ—Ä—ñ–≤</h2>

<p>
–ö–æ–ª–æ–Ω–∫–∞ –∑ –Ω–æ–º–µ—Ä–æ–º ‚Ññ
<input type="number" id="colIndex" value="3" min="1">
</p>

<textarea placeholder="–í—Å—Ç–∞–≤ –¥–∞–Ω—ñ (Ctrl+V) –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂ CSV / TSV"></textarea>
<br>
<input type="file" accept=".csv,.tsv,.txt">
<br><br>

<button onclick="checkDuplicates()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
<button onclick="downloadUnique()">üì• –£–Ω—ñ–∫–∞–ª—å–Ω—ñ (CSV)</button>
<button onclick="downloadDuplicates()">üì• –î—É–±–ª—ñ (CSV)</button>

<h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
<div class="stat" id="stats"></div>
<details id="uniqueDetails" style="display:none;">
  <summary>üìÑ –ü–æ–∫–∞–∑–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –Ω–æ–º–µ—Ä—ñ–≤ –±–µ–∑ –¥—É–±–ª—ñ–≤</summary>
  <pre id="uniqueList"></pre>
</details>

<h3>üîÅ –î—É–±–ª—ñ (–∑–≥—Ä—É–ø–æ–≤–∞–Ω—ñ):</h3>
<pre id="duplicates"></pre>

<script>
let uniqueData = [];
let duplicateData = [];

function splitLine(line) {
  return line.split(/\t|;|,(?=(?:[^"]*"[^"]*")*[^"]*$)|\s{2,}/);
}

function normalize(val) {
  return val.replace(/^'+/, "").trim();
}

function checkDuplicates() {
  const text = document.querySelector("textarea").value.trim();
  const colIndex = parseInt(document.getElementById("colIndex").value, 10) - 1;
  if (!text) return;

  const lines = text.split(/\r?\n/);
  const groups = {};
  const order = [];

  for (const line of lines) {
    const cols = splitLine(line);
    if (!cols[colIndex]) continue;

    const number = normalize(cols[colIndex]);
    if (!groups[number]) {
      groups[number] = [];
      order.push(number);
    }
    groups[number].push(line);
  }

  uniqueData = [];
  duplicateData = [];

  let dupOut = "";
  let duplicateNumberCount = 0;
  let duplicateRowCount = 0;

  for (const number of order) {
    const rows = groups[number];
    if (rows.length === 1) {
      uniqueData.push(number);
    } else {
      duplicateNumberCount++;
      duplicateRowCount += rows.length;
      for (const row of rows) {
        const line = `${row} ‚Äî –î—É–±–ª—å (${rows.length} —Ä–∞–∑–∏)`;
        duplicateData.push(line);
        dupOut += line + "\n";
      }
      dupOut += "\n";
    }
  }

  document.getElementById("duplicates").textContent =
    dupOut || "–î—É–±–ª—ñ–∫–∞—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ";

  document.getElementById("stats").textContent =
    `üîÅ –ù–æ–º–µ—Ä—ñ–≤ –∑ –¥—É–±–ª—è–º–∏: ${duplicateNumberCount} | ` +
    `üìÑ –†—è–¥–∫—ñ–≤-–¥—É–±–ª—ñ–≤: ${duplicateRowCount} | ` +
    `‚úÖ –ù–æ–º–µ—Ä—ñ–≤ –±–µ–∑ –¥—É–±–ª—ñ–≤: ${uniqueData.length}`;

  const details = document.getElementById("uniqueDetails");
  const list = document.getElementById("uniqueList");

  if (uniqueData.length) {
    list.textContent = uniqueData.join("\n");
    details.style.display = "block";
  } else {
    details.style.display = "none";
  }
}

function downloadCSV(filename, rows) {
  const blob = new Blob([rows.join("\n")], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
}

function downloadUnique() {
  if (!uniqueData.length) return;
  downloadCSV("unique_numbers.csv", uniqueData);
}

function downloadDuplicates() {
  if (!duplicateData.length) return;
  downloadCSV("duplicate_rows.csv", duplicateData);
}

document.querySelector("input[type=file]").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    document.querySelector("textarea").value = reader.result;
  };
  reader.readAsText(file);
});
</script>

</body>
</html>
