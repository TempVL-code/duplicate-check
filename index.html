<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤</title>
<style>
body { font-family: Arial, sans-serif; max-width: 1000px; margin: 30px auto; }
textarea { width: 100%; height: 220px; }
button { padding: 8px 16px; margin: 5px 5px 5px 0; }
pre { background: #f4f4f4; padding: 10px; white-space: pre-wrap; }
input { width: 60px; }
</style>
</head>
<body>

<h2>üîÅ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤ –Ω–æ–º–µ—Ä—ñ–≤</h2>

<p>
–í–∫–∞–∂—ñ—Ç—å –∫–æ–ª–æ–Ω–∫—É –∑ –Ω–æ–º–µ—Ä–æ–º ‚Ññ
<input type="number" id="colIndex" value="3" min="1">
</p>

<textarea placeholder="–í—Å—Ç–∞–≤ –¥–∞–Ω—ñ (Ctrl+V) –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂ CSV / TSV"></textarea>
<br>
<input type="file" accept=".csv,.tsv,.txt">
<br><br>

<button onclick="checkDuplicates()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
<button onclick="downloadUnique()">üì• –£–Ω—ñ–∫–∞–ª—å–Ω—ñ (CSV)</button>
<button onclick="downloadDuplicates()">üì• –î—É–±–ª—ñ (CSV)</button>

<h3>‚úÖ –ù–æ–º–µ—Ä–∏ –±–µ–∑ –¥—É–±–ª—ñ–≤:</h3>
<pre id="unique"></pre>

<h3>üîÅ –î—É–±–ª—ñ (–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é):</h3>
<pre id="duplicates"></pre>

<script>
let uniqueData = [];
let duplicateData = [];

function splitLine(line) {
  return line.split(/\t|;|,(?=(?:[^"]*"[^"]*")*[^"]*$)|\s{2,}/);
}

function normalize(val) {
  return val.replace(/^'+/, "").trim();
}

function checkDuplicates() {
  const text = document.querySelector("textarea").value.trim();
  const colIndex = parseInt(document.getElementById("colIndex").value, 10) - 1;
  if (!text) return;

  const lines = text.split(/\r?\n/);
  const rows = [];
  const countMap = {};

  for (const line of lines) {
    const cols = splitLine(line);
    if (!cols[colIndex]) continue;
    const number = normalize(cols[colIndex]);
    rows.push({ line, number });
    countMap[number] = (countMap[number] || 0) + 1;
  }

  uniqueData = [];
  duplicateData = [];

  let uniqueOut = "";
  let dupOut = "";

  for (const row of rows) {
    const count = countMap[row.number];
    if (count === 1) {
      uniqueData.push(row.number);
      uniqueOut += row.number + "\n";
    } else {
      duplicateData.push(row.line + ` ‚Äî –î—É–±–ª—å (${count} —Ä–∞–∑–∏)`);
      dupOut += row.line + ` ‚Äî –î—É–±–ª—å (${count} —Ä–∞–∑–∏)\n`;
    }
  }

  document.getElementById("unique").textContent =
    uniqueOut || "–£–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –Ω–æ–º–µ—Ä—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ";

  document.getElementById("duplicates").textContent =
    dupOut || "–î—É–±–ª—ñ–∫–∞—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ";
}

function downloadCSV(filename, rows) {
  const blob = new Blob([rows.join("\n")], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
}

function downloadUnique() {
  if (!uniqueData.length) return;
  downloadCSV("unique_numbers.csv", uniqueData);
}

function downloadDuplicates() {
  if (!duplicateData.length) return;
  downloadCSV("duplicate_rows.csv", duplicateData);
}

document.querySelector("input[type=file]").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    document.querySelector("textarea").value = reader.result;
  };
  reader.readAsText(file);
});
</script>

</body>
</html>
